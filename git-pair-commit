#!/bin/bash
# git-pair-commit: Commit with pair info appended to the title line

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PAIR_FILE=".git/.pair"

# Check if we're in a git repository
if [ ! -d ".git" ]; then
  echo "Error: Not a git repository"
  exit 1
fi

# Check if pair mode is active
if [ ! -f "$PAIR_FILE" ]; then
  echo "Pair mode is not enabled. Use 'git pair --with username' first."
  exit 1
fi

PAIRER=$(cat "$PAIR_FILE")
PAIR_INFO="(paired with @$PAIRER)"

# Parse arguments
while [[ $# -gt 0 ]]; do
  case $1 in
    -m|--message)
      shift
      COMMIT_MSG="$1"
      shift
      ;;
    *)
      ARGS+="$1 "
      shift
      ;;
  esac
done

if [ -z "$COMMIT_MSG" ]; then
  echo "Usage: git pair-commit -m \"your commit message\" [other git commit options]"
  exit 1
fi

# Compose the message with pair info in the title
TITLE_WITH_PAIR="$COMMIT_MSG $PAIR_INFO"

git commit -m "$TITLE_WITH_PAIR" $ARGS 